# HG changeset patch
# User Fernando Jimenez <ferjmoreno@gmail.com>
# Parent  4c82ee66b1f8e13464f5cb902bc63ea26fe74706

diff --git a/dom/settings/tests/chrome.ini b/dom/settings/tests/chrome.ini
--- a/dom/settings/tests/chrome.ini
+++ b/dom/settings/tests/chrome.ini
@@ -3,8 +3,9 @@ skip-if = buildapp != 'b2g'
 support-files =
   test_settings_service.js
   test_settings_service_callback.js
 
 
 [test_settings_service.xul]
 skip-if= buildapp == 'mulet'
 [test_settings_service_callback.xul]
+[test_bug1225157.xul]
diff --git a/dom/settings/tests/test_bug1225157.xul b/dom/settings/tests/test_bug1225157.xul
new file mode 100644
--- /dev/null
+++ b/dom/settings/tests/test_bug1225157.xul
@@ -0,0 +1,29 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/css" href="chrome://global/skin"?>
+<?xml-stylesheet type="text/css" href="/tests/SimpleTest/test.css"?>
+<!--
+https://bugzilla.mozilla.org/show_bug.cgi?id=678695
+-->
+<window title="Mozilla Bug 678695"
+        xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
+  <script type="application/javascript"
+          src="chrome://mochikit/content/tests/SimpleTest/SimpleTest.js"></script>
+
+  <!-- test results are displayed in the html:body -->
+  <body xmlns="http://www.w3.org/1999/xhtml">
+  <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=678695"
+     target="_blank">Mozilla Bug 678695</a>
+  </body>
+
+  <script type="application/javascript;version=1.7">
+    SimpleTest.waitForExplicitFinish();
+    SpecialPowers.pushPrefEnv({
+      "set": [
+        ["something", "something"]
+      ]
+    }, () => {
+      ok(SpecialPowers.getCharPref("something") == "something", "OK");
+      SimpleTest.finish();
+    });
+  </script>
+</window>
